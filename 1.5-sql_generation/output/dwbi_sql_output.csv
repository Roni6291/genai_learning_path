question_id,question,target_source,sql,assumptions,confidence
1,What are the top 5 products by sales amount in the last 90 days?,sales_dw,"WITH last_90_days AS (SELECT DATE_SUB(CURRENT_DATE, INTERVAL 90 DAY) AS start_date),
        top_products AS (
            SELECT p.product_name, SUM(s.sales_amount) AS total_sales
            FROM sales s
            JOIN products p ON s.product_id = p.product_id
            WHERE s.sale_date >= (SELECT start_date FROM last_90_days)
            GROUP BY p.product_name
            ORDER BY total_sales DESC
            LIMIT 5
        )
    SELECT * FROM top_products;",Assumed sales data is complete for the last 90 days. No missing data handling implemented.,HIGH
2,Show the month-over-month sales growth by region for the past 6 months.,sales_dw,"WITH monthly_sales AS (
  SELECT s.region, EXTRACT(MONTH FROM s.sale_date) AS month, EXTRACT(YEAR FROM s.sale_date) AS year, SUM(s.sales_amount) AS total_sales
  FROM sales s
  WHERE s.sale_date >= DATE_SUB(CURRENT_DATE, INTERVAL 6 MONTH)
  GROUP BY s.region, EXTRACT(MONTH FROM s.sale_date), EXTRACT(YEAR FROM s.sale_date)
)
SELECT ms1.region, ms1.month, ms1.year, ms1.total_sales, ms2.total_sales AS prev_month_sales, ms1.total_sales - ms2.total_sales AS sales_growth
FROM monthly_sales ms1
JOIN monthly_sales ms2 ON ms1.region = ms2.region AND ms1.month = ms2.month + 1 AND ms1.year = ms2.year
WHERE ms1.month = 12 OR (ms1.month != 12 AND ms2.month != 12)
ORDER BY ms1.region, ms1.month;",Assumed sales data is available for the past 6 months. Sales data is aggregated by month and region.,HIGH
3,Which categories contributed the most to total revenue in the last year?,sales_dw,"WITH last_year_sales AS (
    SELECT 
      p.category, 
      SUM(s.sales_amount) AS total_revenue
    FROM 
      sales s
    JOIN 
      products p ON s.product_id = p.product_id
    WHERE 
      s.sale_date >= DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR)
    GROUP BY 
      p.category
  )
  SELECT 
    category, 
    total_revenue
  FROM 
    last_year_sales
  ORDER BY 
    total_revenue DESC;",Assumed sales data is complete for the last year. No missing data handling implemented.,HIGH
4,Find the average order value (AOV) per region in the current quarter.,sales_dw,ORDER BY avg_order_value DESC;,Assumed current quarter starts from the first day of the quarter and ends on the last day of the quarter.,HIGH
5,Identify the top 3 brands with highest quantity sold in the last 30 days.,sales_dw,"WITH last_30_days AS (SELECT DATE_SUB(CURRENT_DATE, INTERVAL 30 DAY) AS start_date),
        brand_sales AS (
            SELECT 
                p.brand, 
                SUM(s.quantity) AS total_quantity
            FROM 
                sales s
            JOIN 
                products p ON s.product_id = p.product_id
            WHERE 
                s.sale_date >= (SELECT start_date FROM last_30_days)
            GROUP BY 
                p.brand
        )
    SELECT 
        brand, 
        total_quantity
    FROM 
        brand_sales
    ORDER BY 
        total_quantity DESC
    LIMIT 3;",Assumed sales data is up-to-date and accurate. No missing data handling for sales data.,HIGH
6,Which subcategory had the sharpest decline in sales compared to the previous quarter?,sales_dw,"WITH 
    -- Calculate sales for the current quarter
    current_quarter_sales AS (
      SELECT 
        s.product_id,
        p.subcategory,
        SUM(s.sales_amount) AS current_quarter_sales_amount
      FROM 
        sales_dw.sales s
      JOIN 
        sales_dw.products p ON s.product_id = p.product_id
      WHERE 
        EXTRACT(MONTH FROM s.sale_date) BETWEEN EXTRACT(MONTH FROM CURRENT_DATE) AND EXTRACT(MONTH FROM CURRENT_DATE) + 2
      GROUP BY 
        s.product_id, p.subcategory
    ),
    
    -- Calculate sales for the previous quarter
    previous_quarter_sales AS (
      SELECT 
        s.product_id,
        p.subcategory,
        SUM(s.sales_amount) AS previous_quarter_sales_amount
      FROM 
        sales_dw.sales s
      JOIN 
        sales_dw.products p ON s.product_id = p.product_id
      WHERE 
        EXTRACT(MONTH FROM s.sale_date) BETWEEN EXTRACT(MONTH FROM CURRENT_DATE) - 3 AND EXTRACT(MONTH FROM CURRENT_DATE) - 1
      GROUP BY 
        s.product_id, p.subcategory
    ),
    
    -- Calculate the decline in sales
    sales_decline AS (
      SELECT 
        subcategory,
        current_quarter_sales_amount,
        previous_quarter_sales_amount,
        (current_quarter_sales_amount - previous_quarter_sales_amount) / previous_quarter_sales_amount AS sales_decline_percentage
      FROM 
        current_quarter_sales
      JOIN 
        previous_quarter_sales ON current_quarter_sales.product_id = previous_quarter_sales.product_id AND current_quarter_sales.subcategory = previous_quarter_sales.subcategory
    )
    
    -- Find the subcategory with the sharpest decline in sales
    SELECT 
      subcategory,
      sales_decline_percentage
    FROM 
      sales_decline
    ORDER BY 
      sales_decline_percentage DESC
    LIMIT 1;",Assumed current quarter starts from the first month of the current quarter. Previous quarter is assumed to be the quarter before the current quarter.,HIGH
7,What is the percentage contribution of each region to total sales this year?,sales_dw,"WITH sales_this_year AS (
    SELECT 
      region,
      SUM(sales_amount) AS total_sales
    FROM 
      sales_dw.sales
    WHERE 
      EXTRACT(YEAR FROM sale_date) = EXTRACT(YEAR FROM CURRENT_DATE)
    GROUP BY 
      region
  )
  SELECT 
    region,
    ROUND((total_sales / (SELECT SUM(total_sales) FROM sales_this_year)) * 100, 2) AS percentage_contribution
  FROM 
    sales_this_year;",Assumed current year is the year of the current date. No assumptions about missing data or specific interpretations.,HIGH
8,Show the trend of sales_amount vs quantity sold for Electronics products.,sales_dw,"WITH sales_trend AS (
    SELECT 
      s.sale_date,
      p.category,
      s.quantity,
      s.sales_amount
    FROM 
      sales_dw.sales s
    JOIN 
      sales_dw.products p ON s.product_id = p.product_id
    WHERE 
      p.category = 'Electronics'
  )
  SELECT 
    EXTRACT(YEAR FROM sale_date) AS year,
    EXTRACT(MONTH FROM sale_date) AS month,
    AVG(quantity) AS avg_quantity,
    AVG(sales_amount) AS avg_sales_amount
  FROM 
    sales_trend
  GROUP BY 
    EXTRACT(YEAR FROM sale_date),
    EXTRACT(MONTH FROM sale_date)
  ORDER BY 
    year, month;",Assumed current quarter starts from Oct 1. Date calculations are based on standard SQL date functions.,HIGH
9,Find the product with the highest sales per unit (sales_amount รท quantity) in the last 60 days.,sales_dw,"WITH sales_last_60_days AS (
    SELECT product_id, SUM(sales_amount) / SUM(quantity) AS sales_per_unit
    FROM sales_dw.sales
    WHERE sale_date >= DATE_SUB(CURRENT_DATE, INTERVAL 60 DAY)
    GROUP BY product_id
   )
   SELECT p.product_name, slp.sales_per_unit
   FROM products p
   JOIN sales_last_60_days slp ON p.product_id = slp.product_id
   ORDER BY slp.sales_per_unit DESC
   LIMIT 1;",Assumed sales data is complete for the last 60 days. No missing data handling implemented.,HIGH
10,List the top 10 customers by revenue (if customer table exists).,sales_dw,"WITH customer_sales AS (
    SELECT 
      s.sale_id,
      s.product_id,
      s.region,
      s.sale_date,
      s.sales_amount,
      s.quantity,
      p.product_name,
      p.category,
      p.subcategory,
      p.brand
    FROM 
      sales s
    JOIN 
      products p ON s.product_id = p.product_id
  )
  SELECT 
    -- Assuming customer_id is not available, using product_id as a surrogate
    p.product_name AS customer_name,
    SUM(s.sales_amount) AS total_revenue
  FROM 
    customer_sales s
  JOIN 
    products p ON s.product_id = p.product_id
  GROUP BY 
    p.product_name
  ORDER BY 
    total_revenue DESC
  LIMIT 10;",Assumed product_id as a surrogate for customer_id since customer table not found in schema.,MEDIUM
11,Which channel had the highest total impressions in the last quarter?,marketing_dw,"WITH last_quarter_start AS (SELECT DATE_SUB(CURRENT_DATE, INTERVAL 3 QUARTER) AS start_date),
        last_quarter_end AS (SELECT DATE_SUB(CURRENT_DATE, INTERVAL 1 QUARTER) AS end_date),
        campaign_impressions AS (
            SELECT c.channel, SUM(i.impressions) AS total_impressions
            FROM campaigns c
            JOIN impressions i ON c.campaign_id = i.campaign_id
            WHERE i.day BETWEEN (SELECT start_date FROM last_quarter_start) AND (SELECT end_date FROM last_quarter_end)
            GROUP BY c.channel
        )
    SELECT channel, total_impressions
    FROM campaign_impressions
    ORDER BY total_impressions DESC
    LIMIT 1;",Assumed current quarter starts from Oct 1. Date calculations are based on the assumption that the quarter starts on the 1st day of the month.,HIGH
12,Calculate the average click-through rate (CTR) per channel last month.,marketing_dw,ORDER BY avg_ctr DESC;,Assumed current date is used as reference point for last month calculation.,HIGH
13,Which campaign delivered the lowest cost per click (CPC) in the last 6 months?,marketing_dw,"WITH last_six_months AS (SELECT DATE_SUB(CURRENT_DATE, INTERVAL 6 MONTH) AS start_date),
        campaign_cpc AS (
            SELECT c.campaign_id, c.channel, c.budget, i.day, i.impressions, i.clicks,
                   (i.clicks / i.impressions) * 100 AS ctr,
                   (c.budget / SUM(i.clicks) OVER (PARTITION BY c.campaign_id)) AS cpc
            FROM campaigns c
            JOIN impressions i ON c.campaign_id = i.campaign_id
            WHERE c.start_date <= (SELECT start_date FROM last_six_months)
              AND c.end_date >= (SELECT start_date FROM last_six_months)
        )
    SELECT channel, campaign_id, budget, day, impressions, clicks, ctr, cpc
    FROM campaign_cpc
    ORDER BY cpc ASC
    LIMIT 1;",Assumed campaign budget is evenly distributed across the campaign duration. Campaigns with no clicks are excluded from the calculation.,MEDIUM
14,Find the total budget spent per channel in the last year.,marketing_dw,"WITH last_year AS (SELECT DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR) AS start_date),
        channel_budget AS (
            SELECT c.channel, SUM(c.budget) AS total_budget
            FROM marketing_dw.campaigns c
            JOIN marketing_dw.impressions i ON c.campaign_id = i.campaign_id
            WHERE i.day BETWEEN (SELECT start_date FROM last_year) AND CURRENT_DATE
            GROUP BY c.channel
        )
    SELECT channel, total_budget
    FROM channel_budget
    ORDER BY total_budget DESC;",Assumed that the budget is spent on the same day as the impressions. Implications of impressions not being directly related to budget are not considered.,HIGH
15,Identify the top 3 campaigns by impressions during their active periods.,marketing_dw,"WITH campaign_impressions AS (
    SELECT 
      c.campaign_id,
      c.channel,
      SUM(i.impressions) AS total_impressions
    FROM 
      marketing_dw.campaigns c
    JOIN 
      marketing_dw.impressions i ON c.campaign_id = i.campaign_id
    WHERE 
      c.start_date <= CURRENT_DATE AND c.end_date >= CURRENT_DATE
    GROUP BY 
      c.campaign_id, c.channel
  )
  SELECT 
    campaign_id, channel, total_impressions
  FROM 
    campaign_impressions
  ORDER BY 
    total_impressions DESC
  LIMIT 3;",Assumed current date is used as the reference point for active campaigns. Campaigns with no impressions are excluded from the results.,HIGH
16,What is the daily average impressions vs clicks trend for Social Media campaigns?,marketing_dw,"WITH daily_impressions AS (
  SELECT c.campaign_id, i.day, i.impressions, i.clicks
  FROM campaigns c
  JOIN impressions i ON c.campaign_id = i.campaign_id
  WHERE c.channel = 'Social Media'
  AND i.day BETWEEN DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR) AND CURRENT_DATE
)
SELECT day, AVG(impressions) AS avg_impressions, AVG(clicks) AS avg_clicks
FROM daily_impressions
GROUP BY day
ORDER BY day;",Assumed current date is used as the reference point for date calculations. Impression and click data is available for the last year.,HIGH
17,Which channel shows the highest conversion ratio (clicks รท impressions) overall?,marketing_dw,"WITH campaign_impressions AS (
    SELECT 
      c.campaign_id,
      c.channel,
      SUM(i.impressions) AS total_impressions,
      SUM(i.clicks) AS total_clicks
    FROM 
      marketing_dw.campaigns c
    JOIN 
      marketing_dw.impressions i ON c.campaign_id = i.campaign_id
    GROUP BY 
      c.campaign_id, c.channel
  ),
  campaign_ratios AS (
    SELECT 
      channel,
      total_clicks,
      total_impressions,
      (total_clicks / total_impressions) * 100 AS conversion_ratio
    FROM 
      campaign_impressions
  )
  SELECT 
    channel,
    MAX(conversion_ratio) AS max_conversion_ratio
  FROM 
    campaign_ratios
  GROUP BY 
    channel
  ORDER BY 
    max_conversion_ratio DESC
  LIMIT 1;",Assumed that the campaign start and end dates are not relevant for calculating the conversion ratio. Also assumed that the campaign budget is not required for this query.,HIGH
18,List campaigns that ran for more than 60 days and their total spend.,marketing_dw,"WITH campaign_spend AS (
    SELECT 
      c.campaign_id,
      c.channel,
      c.start_date,
      c.end_date,
      c.budget,
      SUM(i.impressions) AS total_impressions,
      SUM(i.clicks) AS total_clicks
    FROM 
      marketing_dw.campaigns c
    JOIN 
      marketing_dw.impressions i ON c.campaign_id = i.campaign_id
    WHERE 
      c.end_date - c.start_date > INTERVAL 60 DAY
    GROUP BY 
      c.campaign_id, c.channel, c.start_date, c.end_date, c.budget
  )
  SELECT 
    campaign_id,
    channel,
    start_date,
    end_date,
    budget AS total_spend
  FROM 
    campaign_spend;",Assumed that the end date of a campaign is the last day of the campaign. Campaigns with missing impressions or clicks are excluded from the results.,HIGH
19,Compare campaign budgets vs actual clicks to highlight underperforming campaigns.,marketing_dw,"WITH campaign_clicks AS (
    SELECT 
      c.campaign_id,
      c.channel,
      c.start_date,
      c.end_date,
      c.budget,
      SUM(i.clicks) AS total_clicks
    FROM 
      marketing_dw.campaigns c
    JOIN 
      marketing_dw.impressions i ON c.campaign_id = i.campaign_id
    WHERE 
      c.end_date >= DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR)  -- Consider last year's data
    GROUP BY 
      c.campaign_id, c.channel, c.start_date, c.end_date, c.budget
  ),
  underperforming_campaigns AS (
    SELECT 
      cc.campaign_id,
      cc.channel,
      cc.start_date,
      cc.end_date,
      cc.budget,
      cc.total_clicks,
      cc.budget / cc.total_clicks AS cpc
    FROM 
      campaign_clicks cc
    WHERE 
      cc.total_clicks < cc.budget * 0.1  -- Assuming 10% of budget as threshold
  )
  SELECT 
    uc.campaign_id,
    uc.channel,
    uc.start_date,
    uc.end_date,
    uc.budget,
    uc.total_clicks,
    uc.cpc
  FROM 
    underperforming_campaigns uc
  ORDER BY 
    uc.cpc DESC;",Assumed 10% of budget as threshold for underperforming campaigns. Considered last year's data for campaign performance.,MEDIUM
20,Find the month with the highest total impressions across all campaigns.,marketing_dw,"WITH campaign_impressions AS (
    SELECT 
      c.campaign_id,
      c.channel,
      i.day,
      i.impressions,
      i.clicks
    FROM 
      marketing_dw.campaigns c
    JOIN 
      marketing_dw.impressions i ON c.campaign_id = i.campaign_id
    WHERE 
      c.start_date <= i.day AND i.day <= c.end_date
  )
  SELECT 
    EXTRACT(MONTH FROM day) AS month,
    SUM(impressions) AS total_impressions
  FROM 
    campaign_impressions
  GROUP BY 
    EXTRACT(MONTH FROM day)
  ORDER BY 
    total_impressions DESC
  LIMIT 1;",Assumed that the campaign start and end dates are inclusive of the impression date.,HIGH
